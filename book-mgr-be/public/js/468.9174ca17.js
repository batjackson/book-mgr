"use strict";(self["webpackChunkbook_mgr_fe"]=self["webpackChunkbook_mgr_fe"]||[]).push([[468],{2468:function(a,e,t){t.r(e),t.d(e,{default:function(){return H}});var c=t(3396),r=t(7139);const o=a=>((0,c.dD)("data-v-04d7c07a"),a=a(),(0,c.Cn)(),a),l=o((()=>(0,c._)("h2",null,"用户管理",-1))),s={class:"search"},n=o((()=>(0,c._)("span",null," ",-1))),d=["onClick"],u=o((()=>(0,c._)("span",null," ",-1))),i=["onClick"],p=["onClick"];function h(a,e,t,o,h,w){const m=(0,c.up)("a-divider"),v=(0,c.up)("a-input-search"),f=(0,c.up)("a-button"),k=(0,c.up)("a-upload"),_=(0,c.up)("space-between"),g=(0,c.up)("EditOutlined"),C=(0,c.up)("a-table"),y=(0,c.up)("a-pagination"),b=(0,c.up)("flex-end"),W=(0,c.up)("a-card"),I=(0,c.up)("add-one"),U=(0,c.up)("a-select-option"),A=(0,c.up)("a-select"),q=(0,c.up)("a-modal"),E=(0,c.Q2)("only-admin");return(0,c.wg)(),(0,c.iD)("div",null,[(0,c.wy)(((0,c.wg)(),(0,c.j4)(W,null,{default:(0,c.w5)((()=>[l,(0,c.Wm)(m),(0,c.Wm)(_,null,{default:(0,c.w5)((()=>[(0,c._)("div",s,[(0,c.Wm)(v,{placeholder:"根据账户搜索","enter-button":"",value:a.keyword,"onUpdate:value":e[0]||(e[0]=e=>a.keyword=e),onSearch:a.onSearch},null,8,["value","onSearch"]),a.isSearch?((0,c.wg)(),(0,c.iD)("a",{key:0,href:"javascript:;",onClick:e[1]||(e[1]=(...e)=>a.backAll&&a.backAll(...e))},"返回")):(0,c.kq)("",!0)]),(0,c._)("div",null,[(0,c.Wm)(f,{onClick:e[2]||(e[2]=e=>a.showAddModal=!0)},{default:(0,c.w5)((()=>[(0,c.Uk)("添加用户")])),_:1}),n,(0,c.Wm)(k,{action:"http://localhost:3001/upload/file",onChange:a.onUploadChange,headers:a.headers},{default:(0,c.w5)((()=>[(0,c.Wm)(f,{type:"primary"},{default:(0,c.w5)((()=>[(0,c.Uk)("上传 Excel 添加")])),_:1})])),_:1},8,["onChange","headers"])])])),_:1}),(0,c.Wm)(m),(0,c._)("div",null,[(0,c.Wm)(C,{bordered:"",pagination:!1,columns:a.columns,"data-source":a.list},{bodyCell:(0,c.w5)((({column:e,record:t})=>["createdAt"===e.dataIndex?((0,c.wg)(),(0,c.iD)(c.HY,{key:0},[(0,c.Uk)((0,r.zw)(a.formatTimeStamp(t.meta.createdAt)),1)],64)):(0,c.kq)("",!0),"actions"===e.dataIndex?((0,c.wg)(),(0,c.iD)(c.HY,{key:1},[(0,c._)("a",{href:"javascript:;",onClick:e=>a.resetPassword(t)},"重置密码",8,d),u,(0,c._)("a",{href:"javascript:;",onClick:e=>a.remove(t)},"删除",8,i)],64)):(0,c.kq)("",!0),"character"===e.dataIndex?((0,c.wg)(),(0,c.iD)(c.HY,{key:2},[(0,c._)("a",{href:"javascript:;",onClick:e=>a.onEdit(t)},[(0,c.Wm)(g)],8,p),(0,c.Uk)(" "+(0,r.zw)(a.getCharacterInfoById(t.character).title),1)],64)):(0,c.kq)("",!0)])),_:1},8,["columns","data-source"])]),a.isSearch?(0,c.kq)("",!0):((0,c.wg)(),(0,c.j4)(b,{key:0,style:{"margin-top":"24px"}},{default:(0,c.w5)((()=>[(0,c.Wm)(y,{current:a.curPage,"onUpdate:current":e[3]||(e[3]=e=>a.curPage=e),total:a.total,"page-size":10,onChange:a.setPage},null,8,["current","total","onChange"])])),_:1}))])),_:1})),[[E]]),(0,c.Wm)(I,{show:a.showAddModal,"onUpdate:show":e[4]||(e[4]=e=>a.showAddModal=e),onGetList:a.getUser},null,8,["show","onGetList"]),(0,c.Wm)(q,{visible:a.showEditCharacterModal,"onUpdate:visible":e[6]||(e[6]=e=>a.showEditCharacterModal=e),title:"修改角色",onOk:a.updateCharacter},{default:(0,c.w5)((()=>[(0,c.Wm)(A,{value:a.editForm.character,"onUpdate:value":e[5]||(e[5]=e=>a.editForm.character=e),style:{width:"220px"}},{default:(0,c.w5)((()=>[((0,c.wg)(!0),(0,c.iD)(c.HY,null,(0,c.Ko)(a.characterInfo,(a=>((0,c.wg)(),(0,c.j4)(U,{key:a._id,value:a._id},{default:(0,c.w5)((()=>[(0,c.Uk)((0,r.zw)(a.title),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1},8,["visible","onOk"])])}var w=t(4870),m=t(1731),v=t(1192),f=t(6842);function k(a,e,t,o,l,s){const n=(0,c.up)("a-input"),d=(0,c.up)("a-form-item"),u=(0,c.up)("a-select-option"),i=(0,c.up)("a-select"),p=(0,c.up)("a-form"),h=(0,c.up)("a-modal");return(0,c.wg)(),(0,c.iD)("div",null,[(0,c.Wm)(h,{title:"添加用户",visible:a.props.show,onOk:a.submit,onCancel:a.close},{default:(0,c.w5)((()=>[(0,c.Wm)(p,{"label-col":{span:6}},{default:(0,c.w5)((()=>[(0,c.Wm)(d,{label:"账号"},{default:(0,c.w5)((()=>[(0,c.Wm)(n,{value:a.addForm.account,"onUpdate:value":e[0]||(e[0]=e=>a.addForm.account=e)},null,8,["value"])])),_:1}),(0,c.Wm)(d,{label:"密码"},{default:(0,c.w5)((()=>[(0,c.Wm)(n,{value:a.addForm.password,"onUpdate:value":e[1]||(e[1]=e=>a.addForm.password=e)},null,8,["value"])])),_:1}),(0,c.Wm)(d,{label:"角色"},{default:(0,c.w5)((()=>[(0,c.Wm)(i,{value:a.addForm.character,"onUpdate:value":e[2]||(e[2]=e=>a.addForm.character=e),style:{width:"220px"}},{default:(0,c.w5)((()=>[((0,c.wg)(!0),(0,c.iD)(c.HY,null,(0,c.Ko)(a.characterInfo,(a=>((0,c.wg)(),(0,c.j4)(u,{key:a._id,value:a._id},{default:(0,c.w5)((()=>[(0,c.Uk)((0,r.zw)(a.title),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})])),_:1})])),_:1},8,["visible","onOk","onCancel"])])}var _=t(4239),g=(0,c.aZ)({props:{show:Boolean},setup(a,e){const{characterInfo:t}=_.Z.state,c={account:"",password:"",character:""},r=()=>{e.emit("update:show",!1)},o=(0,w.qj)((0,m.d9)(c));o.character=t[1]._id;const l=async()=>{const a=(0,m.d9)(o),t=await v.EA.add(a.account,a.password,a.character);(0,m.q6)(t).success(((a,{data:t})=>{Object.assign(o,c),f.ZP.success(t.msg),r(),e.emit("getList")}))};return{addForm:o,submit:l,props:a,close:r,store:_.Z,characterInfo:t}}}),C=t(89);const y=(0,C.Z)(g,[["render",k],["__scopeId","data-v-fc6f13fa"]]);var b=y,W=t(2874),I=t(425),U=t(6366);const A=[{title:"账户",dataIndex:"account"},{title:"创建日期",dataIndex:"createdAt"},{title:"角色",dataIndex:"character"},{title:"操作",dataIndex:"actions"}];var q=(0,c.aZ)({components:{AddOne:b,EditOutlined:U.Z},setup(){const a=(0,w.iH)([]),e=(0,w.iH)(0),t=(0,w.iH)(1),r=(0,w.iH)(!1),o=(0,w.iH)(""),l=(0,w.iH)(!1),s=(0,w.iH)(!1),n=(0,w.qj)({character:"",current:{}}),d=async()=>{const c=await v.EA.list(t.value,10,o.value);(0,m.q6)(c).success((({data:{list:t,total:c}})=>{a.value=t,e.value=c}))};(0,c.bv)((()=>{d()}));const u=async({_id:a})=>{const e=await v.EA.remove(a);(0,m.q6)(e).success((({msg:a})=>{f.ZP.success(a),d()}))},i=a=>{t.value=a,d()},p=async({_id:a})=>{const e=await v.EA.resetPassword(a);(0,m.q6)(e).success((({msg:a})=>{f.ZP.success(a)}))},h=()=>{d(),l.value=!!o.value},k=()=>{l.value=!1,o.value="",d()},g=a=>{n.current=a,n.character=a.character,s.value=!0},C=async()=>{const a=await v.EA.editCharacter(n.character,n.current._id);(0,m.q6)(a).success((({msg:a})=>{f.ZP.success(a),s.value=!1,n.current.character=n.character}))},y=({file:a})=>{a.response&&(0,m.q6)(a.response).success((async a=>{const e=await v.EA.addMany(a);(0,m.q6)(e).success((({msg:a})=>{f.ZP.success(a),d()}))}))};return{list:a,total:e,curPage:t,getUser:d,columns:A,formatTimeStamp:m.jH,remove:u,showAddModal:r,setPage:i,resetPassword:p,keyword:o,isSearch:l,backAll:k,onSearch:h,getCharacterInfoById:I.G,showEditCharacterModal:s,editForm:n,characterInfo:_.Z.state.characterInfo,onEdit:g,updateCharacter:C,onUploadChange:y,headers:(0,W.wU)()}}});const E=(0,C.Z)(q,[["render",h],["__scopeId","data-v-04d7c07a"]]);var H=E}}]);
//# sourceMappingURL=468.9174ca17.js.map