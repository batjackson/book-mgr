"use strict";(self["webpackChunkbook_mgr_fe"]=self["webpackChunkbook_mgr_fe"]||[]).push([[660],{4660:function(a,e,t){t.r(e),t.d(e,{default:function(){return P}});var l=t(3396),o=t(7139);const s=a=>((0,l.dD)("data-v-2741e656"),a=a(),(0,l.Cn)(),a),n={key:0},u=s((()=>(0,l._)("h2",null,"图书列表",-1))),i={class:"search"},d=s((()=>(0,l._)("span",null," ",-1))),c=["onClick"],p=s((()=>(0,l._)("span",null," ",-1))),r=["onClick"],m=s((()=>(0,l._)("span",null," ",-1))),v=["onClick"],w=["onClick"],h=["onClick"],k=s((()=>(0,l._)("div",null,null,-1)));function f(a,e,t,s,f,_){const b=(0,l.up)("a-divider"),y=(0,l.up)("a-input-search"),g=(0,l.up)("a-button"),C=(0,l.up)("a-upload"),U=(0,l.up)("space-between"),W=(0,l.up)("a-table"),D=(0,l.up)("a-pagination"),x=(0,l.up)("flex-end"),I=(0,l.up)("a-card"),q=(0,l.up)("add-one"),Z=(0,l.up)("update"),H=(0,l.Q2)("only-admin");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l.Wm)(I,{title:a.simple?"最近添加的图书":""},{default:(0,l.w5)((()=>[a.simple?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",n,[u,(0,l.Wm)(b),(0,l.Wm)(U,null,{default:(0,l.w5)((()=>[(0,l._)("div",i,[(0,l.Wm)(y,{placeholder:"根据书名搜索","enter-button":"",value:a.keyword,"onUpdate:value":e[0]||(e[0]=e=>a.keyword=e),onSearch:a.onSearch},null,8,["value","onSearch"]),a.isSearch?((0,l.wg)(),(0,l.iD)("a",{key:0,href:"javascript:;",onClick:e[1]||(e[1]=(...e)=>a.backAll&&a.backAll(...e))},"返回")):(0,l.kq)("",!0)]),(0,l._)("div",null,[(0,l.wy)(((0,l.wg)(),(0,l.j4)(g,{onClick:e[2]||(e[2]=e=>a.show=!0)},{default:(0,l.w5)((()=>[(0,l.Uk)("添加一条")])),_:1})),[[H]]),d,(0,l.Wm)(C,{action:"http://localhost:3001/upload/file",onChange:a.onUploadChange,headers:a.headers},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{type:"primary"},{default:(0,l.w5)((()=>[(0,l.Uk)("上传 Excel 添加")])),_:1})])),_:1},8,["onChange","headers"])])])),_:1}),(0,l.Wm)(b)])),(0,l.Wm)(W,{scroll:{x:"max-content"},columns:a.columns,"data-source":a.list,pagination:!1,bordered:""},{bodyCell:(0,l.w5)((({column:e,record:t})=>["publishDate"===e.dataIndex?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l.Uk)((0,o.zw)(a.formatTimeStamp(t.publishDate)),1)],64)):(0,l.kq)("",!0),"actions"!==e.dataIndex||a.simple?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[(0,l._)("a",{href:"javascript:;",onClick:e=>a.toDetail(t)},"详情",8,c),p,(0,l.wy)(((0,l.wg)(),(0,l.iD)("a",{href:"javascript:;",onClick:e=>a.update(t)},[(0,l.Uk)("编辑")],8,r)),[[H]]),m,(0,l.wy)(((0,l.wg)(),(0,l.iD)("a",{href:"javascript:;",onClick:e=>a.remove(t)},[(0,l.Uk)("删除")],8,v)),[[H]])],64)),"count"===e.dataIndex?((0,l.wg)(),(0,l.iD)(l.HY,{key:2},[(0,l._)("a",{href:"javascript:;",onClick:e=>a.updateCount("IN_COUNT",t)},"入库",8,w),(0,l.Uk)(" "+(0,o.zw)(t.count)+" ",1),(0,l._)("a",{href:"javascript:;",onClick:e=>a.updateCount("OUT_COUNT",t)},"出库",8,h)],64)):(0,l.kq)("",!0),"classify"===e.dataIndex?((0,l.wg)(),(0,l.iD)(l.HY,{key:3},[(0,l.Uk)((0,o.zw)(a.getClassifyById(t.classify)),1)],64)):(0,l.kq)("",!0)])),_:1},8,["columns","data-source"]),a.simple?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(x,{key:1,style:{"margin-top":"24px"}},{default:(0,l.w5)((()=>[k,(0,l.Wm)(D,{current:a.curPage,"onUpdate:current":e[3]||(e[3]=e=>a.curPage=e),total:a.total,"page-size":10,onChange:a.setPage},null,8,["current","total","onChange"])])),_:1}))])),_:1},8,["title"]),(0,l.Wm)(q,{show:a.show,"onUpdate:show":e[4]||(e[4]=e=>a.show=e),classifyList:a.bookClassifyList,onGetList:a.getList},null,8,["show","classifyList","onGetList"]),(0,l.Wm)(Z,{show:a.showUpdateModal,"onUpdate:show":e[5]||(e[5]=e=>a.showUpdateModal=e),book:a.curEditBook,onUpdate:a.updateCurBook},null,8,["show","book","onUpdate"])])}t(7658);var _=t(4500),b=t(4870);function y(a,e,t,s,n,u){const i=(0,l.up)("a-input"),d=(0,l.up)("a-form-item"),c=(0,l.up)("a-input-number"),p=(0,l.up)("a-date-picker"),r=(0,l.up)("a-select-option"),m=(0,l.up)("a-select"),v=(0,l.up)("a-form"),w=(0,l.up)("a-modal");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l.Wm)(w,{title:"添加书籍",visible:a.props.show,onOk:a.submit,onCancel:a.close},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{"label-col":{span:6}},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{label:"书名"},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{value:a.addForm.name,"onUpdate:value":e[0]||(e[0]=e=>a.addForm.name=e)},null,8,["value"])])),_:1}),(0,l.Wm)(d,{label:"价格"},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{min:0,max:999999,value:a.addForm.price,"onUpdate:value":e[1]||(e[1]=e=>a.addForm.price=e)},null,8,["value"])])),_:1}),(0,l.Wm)(d,{label:"作者"},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{value:a.addForm.author,"onUpdate:value":e[2]||(e[2]=e=>a.addForm.author=e)},null,8,["value"])])),_:1}),(0,l.Wm)(d,{label:"出版日期"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{value:a.addForm.publishDate,"onUpdate:value":e[3]||(e[3]=e=>a.addForm.publishDate=e)},null,8,["value"])])),_:1}),(0,l.Wm)(d,{label:"分类"},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{value:a.addForm.classify,"onUpdate:value":e[4]||(e[4]=e=>a.addForm.classify=e),style:{width:"120px"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.store.bookClassify,(a=>((0,l.wg)(),(0,l.j4)(r,{key:a._id,value:a._id},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(a.title),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),(0,l.Wm)(d,{label:"库存"},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{value:a.addForm.count,"onUpdate:value":e[5]||(e[5]=e=>a.addForm.count=e)},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["visible","onOk","onCancel"])])}var g=t(1192),C=t(1731),U=t(6842),W=t(4239),D=(0,l.aZ)({props:{show:Boolean},setup(a,e){const t={name:"",price:0,author:"",publishDate:0,classify:"",count:""},l=(0,b.qj)((0,C.d9)(t));W.Z.state.bookClassify.length&&(l.classify=W.Z.state.bookClassify[0]._id);const o=async()=>{const a=(0,C.d9)(l);a.publishDate=l.publishDate.valueOf();const o=await g.s9.add(a);(0,C.q6)(o).success(((a,{data:o})=>{Object.assign(l,t),U.ZP.success(o.msg),e.emit("getList")}))},s=()=>{e.emit("update:show",!1)};return{addForm:l,submit:o,props:a,close:s,store:W.Z.state}}}),x=t(89);const I=(0,x.Z)(D,[["render",y],["__scopeId","data-v-71a49641"]]);var q=I,Z=t(2314),H=t(9685);const j=a=>{const e=W.Z.state.bookClassify.find((e=>e._id===a));return e&&e.title||"未知分类"};var F=t(2874),O=t(2483),S=(0,l.aZ)({components:{AddOne:q,SpaceBetween:_.Z,Update:Z.Z},props:{simple:Boolean},setup(a){const e=(0,O.tv)(),t=[{title:"书字",dataIndex:"name"},{title:"作者",dataIndex:"author"},{title:"价格",dataIndex:"price"},{title:"库存",dataIndex:"count"},{title:"出版日期",dataIndex:"publishDate"},{title:"分类",dataIndex:"classify"}];a.simple||t.push({title:"操作",dataIndex:"actions"});const o=(0,b.iH)(!1),s=(0,b.iH)(!1),n=(0,b.iH)([]),u=(0,b.iH)(0),i=(0,b.iH)(1),d=(0,b.iH)(""),c=(0,b.iH)(!1),p=(0,b.iH)({}),r=async()=>{const a=await g.s9.list({page:i.value,size:10,keyword:d.value});(0,C.q6)(a).success((({data:{list:a,total:e}})=>{n.value=a,u.value=e}))};(0,l.bv)((async()=>{r()}));const m=a=>{i.value=a,r()},v=()=>{r(),c.value=!!d.value},w=()=>{d.value="",c.value=!1,r()},h=async a=>{console.log(a);const{_id:e}=a,t=await g.s9.remove(e);(0,C.q6)(t).success((({msg:a})=>{U.ZP.success(a),r()})),r()},k=(a,e)=>{let t="增加";"OUT_COUNT"===a&&(t="减少"),H.Z.confirm({title:"要增加多少库存呢",content:(0,l.Wm)("div",null,[(0,l.Wm)((0,l.up)("Input"),{class:"__book_input_count"},null)]),onOk:async()=>{const l=document.querySelector(".__book_input_count");let o=l.value;const s=await g.s9.updateCount({id:e._id,num:l.value,type:a});(0,C.q6)(s).success((l=>{o="IN_COUNT"===a?Math.abs(o):-Math.abs(o);const s=n.value.find((a=>a._id===e._id));s&&(s.count=s.count+o,U.ZP.success(`成功${t} ${Math.abs(o)}本书`))}))}})},f=a=>{s.value=!0,p.value=a},_=a=>{Object.assign(p.value,a)},y=a=>{e.push(`/books/${a._id}`)},W=({file:a})=>{a.response&&(0,C.q6)(a.response).success((async a=>{const e=await g.s9.addMany(a);(0,C.q6)(e).success((({data:{addCount:a}})=>{U.ZP.success(`成功添加 ${a} 本书`),r()}))}))};return{columns:t,show:o,list:n,formatTimeStamp:C.jH,curPage:i,total:u,setPage:m,keyword:d,onSearch:v,backAll:w,isSearch:c,remove:h,updateCount:k,showUpdateModal:s,update:f,curEditBook:p,updateCurBook:_,toDetail:y,getList:r,getClassifyById:j,simple:a.simple,onUploadChange:W,headers:(0,F.wU)()}}});const B=(0,x.Z)(S,[["render",f],["__scopeId","data-v-2741e656"]]);var P=B}}]);
//# sourceMappingURL=660.9a054557.js.map